{% extends 'layouts/base.html' %}

{% block title %} {{ "SETTINGS" | gettext }} {% endblock title %}

{% block content %}
    <!-- Page content -->
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <div class="card mb-4">
                    <div class="card-header pb-0">
                        <h6 class="mb-0">{{ "SETTINGS_LABEL" | gettext }}</h6>
                    </div>
                    <div class="card-body">
                        <button type="button" class="btn bg-gradient-success"
                                onclick="query_webhook()">
                            {{ "SET_WEBHOOK" | gettext }}
                        </button>
                        <button class="btn bg-gradient-danger"
                                onclick="location.href='/advanced.html'">
                            {{ "ADVANCED" | gettext }}
                        </button>
                        <button class="btn bg-gradient-info"
                                onclick="location.href='/userscripts.html'">
                            {{ "CLOUD_SCRIPTS" | gettext }}
                        </button>
                        <button type="button" class="btn bg-gradient-warning"
                                onclick="query_purge()">
                            {{ "PURGE_CACHE" | gettext }}
                        </button>
                        <button type="button" class="btn bg-gradient-danger"
                                onclick="query_update()">
                            {{ "ONEKEY_UPDATE" | gettext }}
                        </button>
                        <button type="button" class="btn bg-gradient-primary"
                                onclick="location.href='/migrate/'">
                            {{ "MIGRATE" | gettext }}
                        </button>
                        <form id="apikey-settings" onsubmit="return false;">
                            <hr class="my-4"/>
                            <h6 class="heading-small text-muted mb-4">{{ "SET_API" | gettext }}</h6>
                            <div class="pl-lg-4">
                                <div class="row">
                                    {% csrf_token %}
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">{{ "SET_API_1" | gettext }}</label>
                                            <input type="text" name="apikey" class="form-control"
                                                   placeholder="{{ "SET_API_1_PH" | gettext }}">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_API_2" | gettext }}</label>
                                            <select name="allow_friend" class="form-control">
                                                <option{% if ALLOW_FRIEND == "是" %}
                                                    selected{% endif %}>是
                                                </option>
                                                <option{% if ALLOW_FRIEND != "是" %}
                                                    selected{% endif %}>否
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_API_3" | gettext }}</label>
                                            <select name="friend-recaptcha" class="form-control">
                                                <option{% if FRIEND_RECAPTCHA == "v2" %}
                                                    selected{% endif %}>v2
                                                </option>
                                                <option{% if FRIEND_RECAPTCHA == "v3" %}
                                                    selected{% endif %}>v3
                                                </option>
                                                <option{% if FRIEND_RECAPTCHA == "关闭" %}
                                                    selected{% endif %}>关闭
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_API_4" | gettext }}</label>
                                            <input type="text" name="recaptcha-token"
                                                   class="form-control"
                                                   placeholder="{{ "SET_API_4_PH" | gettext }}"
                                                   value="{{ RECAPTCHA_TOKEN }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <input type="button" class="btn btn-primary"
                                               value="{{ "SUBMIT" | gettext }}"
                                               onclick="set_api()">
                                    </div>
                                </div>
                            </div>
                        </form>
                        <form id="statistic-settings" onsubmit="return false;">
                            <hr class="my-4"/>
                            <h6 class="heading-small text-muted mb-4">{{ "SET_STATISTICS" | gettext }}</h6>
                            <div class="pl-lg-4">
                                <div class="row">
                                    {% csrf_token %}
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">{{ "SET_STATISTICS_1" | gettext }}</label>
                                            <select name="allow_statistic" class="form-control">
                                                <option{% if STATISTIC_ALLOW == "是" %}
                                                    selected{% endif %}>是
                                                </option>
                                                <option{% if STATISTIC_ALLOW != "是" %}
                                                    selected{% endif %}>否
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_STATISTICS_2" | gettext }}</label>
                                            <input type="text" name="statistic_domains"
                                                   class="form-control"
                                                   placeholder="{{ "SET_STATISTICS_2_PH" | gettext }}"
                                                   value="{{ STATISTIC_DOMAINS }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <input type="button" class="btn btn-primary"
                                               value="{{ "SUBMIT" | gettext }}"
                                               onclick="set_statistic()">
                                    </div>
                                </div>
                            </div>
                        </form>
                        <form id="user-settings" onsubmit="return false;">
                            <hr class="my-4"/>
                            <h6 class="heading-small text-muted mb-4">{{ "SET_USER" | gettext }}</h6>
                            <div class="pl-lg-4">
                                <div class="row">
                                    {% csrf_token %}
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_USER_1" | gettext }}</label>
                                            <input type="text" name="password" class="form-control"
                                                   placeholder="{{ "SET_USER_1_PH" | gettext }}">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_USER_2" | gettext }}</label>
                                            <input type="text" name="username" class="form-control"
                                                   placeholder="{{ "SET_USER_2_PH" | gettext }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_USER_3" | gettext }}</label>
                                            <input type="text" name="newpassword"
                                                   class="form-control"
                                                   placeholder="{{ "SET_USER_3_PH" | gettext }}">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_USER_4" | gettext }}</label>
                                            <input type="text" name="repassword"
                                                   class="form-control"
                                                   placeholder="{{ "SET_USER_4_PH" | gettext }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <input type="button" class="btn btn-primary"
                                               value="{{ "SUBMIT" | gettext }}"
                                               onclick="submit_user_config()">
                                    </div>
                                </div>
                            </div>
                        </form>
                        <form id="security-settings" onsubmit="return false;">
                            <hr class="my-4"/>
                            <h6 class="heading-small text-muted mb-4">{{ "SET_SECURE" | gettext }}</h6>
                            <div class="pl-lg-4">
                                <div class="row">
                                    {% csrf_token %}
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">{{ "SET_SECURE_1" | gettext }}</label>
                                            <input type="text" name="site-token"
                                                   class="form-control"
                                                   placeholder="{{ "SET_SECURE_1_PH" | gettext }}"
                                                   value="{{ LOGIN_RECAPTCHA_SITE_TOKEN }}">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">{{ "SET_SECURE_2" | gettext }}</label>
                                            <input type="text" name="server-token"
                                                   class="form-control"
                                                   placeholder="{{ "SET_SECURE_2_PH" | gettext }}"
                                                   value="{{ LOGIN_RECAPTCHA_SERVER_TOKEN }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_USER_3_PH" | gettext }}</label>
                                            <input type="text" name="site-token-v2"
                                                   class="form-control"
                                                   placeholder="{{ "SET_SECURE_3_PH" | gettext }}"
                                                   value="{{ LOGIN_RECAPTCHAV2_SITE_TOKEN }}">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_USER_4_PH" | gettext }}</label>
                                            <input type="text" name="server-token-v2"
                                                   class="form-control"
                                                   placeholder="{{ "SET_SECURE_4_PH" | gettext }}"
                                                   value="{{ LOGIN_RECAPTCHAV2_SERVER_TOKEN }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <input type="button" class="btn btn-primary"
                                               value="{{ "SUBMIT" | gettext }}"
                                               onclick="submit_security_config()">
                                    </div>
                                </div>
                            </div>
                        </form>
                        <form id="hexo-settings" onsubmit="return false;">
                            <hr class="my-4"/>
                            <h6 class="heading-small text-muted mb-4">
                                {{ "SET_BLOG" | gettext }}</h6>
                            <div class="pl-lg-4">
                                {% csrf_token %}
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_BLOG_1" | gettext }}</label>
                                            <select name="provider" id="provider-container"
                                                    class="form-control"
                                                    onchange="change_provider(this.value)">
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_BLOG_2" | gettext }}</label>
                                            <select name="config" id="config-container"
                                                    class="form-control">
                                                {% for config in ALL_PLATFORM_CONFIGS %}
                                                    <option value="{{ config }}"
                                                            {% if NOW_PLATFORM_CONFIG == config %}
                                                            selected{% endif %}
                                                    >{{ config }}</option>
                                                {% endfor %}
                                            </select>

                                        </div>
                                    </div>
                                </div>
                                <div id="hexo-settings-container"></div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <input type="button" class="btn btn-primary"
                                               value="{{ "SUBMIT" | gettext }}"
                                               onclick="set_hexo(false)">
                                        <input type="button" class="btn btn-white"
                                               value="{{ "FORCE_SUBMIT" | gettext }}"
                                               onclick="set_hexo(true)">
                                    </div>
                                </div>
                            </div>
                        </form>
                        <form id="notify-settings" onsubmit="return false;">
                            <hr class="my-4"/>
                            <h6 class="heading-small text-muted mb-4">
                                {{ "SET_NOTIFY" | gettext }}</h6>
                            <div class="pl-lg-4">
                                {% csrf_token %}
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_NOTIFY_1" | gettext }}</label>
                                            <select name="notifier" id="onepush-container"
                                                    class="form-control"
                                                    onchange="change_pusher(this.value)">
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div id="onepush-settings-container"></div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <input type="button" class="btn btn-primary"
                                               value="{{ "SUBMIT" | gettext }}"
                                               onclick="set_onepush()">
                                        <input type="button" class="btn btn-info"
                                               value="{{ "TEST" | gettext }}"
                                               onclick="test_onepush()">
                                    </div>
                                </div>
                            </div>
                        </form>
                        <form id="abbrlink-settings" onsubmit="return false;">
                            <hr class="my-4"/>
                            <h6 class="heading-small text-muted mb-4">
                                {{ "SET_ABBRLINK" | gettext }}</h6>
                            <div class="pl-lg-4">
                                <div class="row">
                                    {% csrf_token %}
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_ABBRLINK_1" | gettext }}</label>
                                            <select name="alg" class="form-control">
                                                <option{% if ABBRLINK_ALG == "crc16" %}
                                                    selected{% endif %}>crc16
                                                </option>
                                                <option{% if ABBRLINK_ALG == "crc32" %}
                                                    selected{% endif %}>crc32
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_ABBRLINK_2" | gettext }}</label>
                                            <select name="rep" class="form-control">
                                                <option{% if ABBRLINK_REP == "hex" %}
                                                    selected{% endif %}>hex
                                                </option>
                                                <option{% if ABBRLINK_REP == "dec" %}
                                                    selected{% endif %}>dec
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <input type="button" class="btn btn-primary"
                                               value="{{ "SUBMIT" | gettext }}"
                                               onclick="submit_abbrlink_config()">
                                    </div>
                                </div>
                            </div>
                        </form>
                        <form id="excerpt-settings" onsubmit="return false;">
                            <hr class="my-4"/>
                            <h6 class="heading-small text-muted mb-4">
                                {{ "SET_EXCERPT" | gettext }}</h6>
                            <div class="pl-lg-4">
                                <div class="row">
                                    {% csrf_token %}
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_EXCERPT_1" | gettext }}</label>
                                            <select class="form-control" name="excerpt-type"
                                                    id="excerpt-method-container"
                                                    onchange="change_excerpt(this.value)">
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_EXCERPT_2" | gettext }}</label>
                                            <select class="form-control" name="auto-excerpt"
                                                    id="auto-excerpt">
                                                <option{% if AUTO_EXCERPT == "关闭" %} selected
                                                {% endif %}>关闭
                                                </option>
                                                <option{% if AUTO_EXCERPT == "仅发布文章时" %}
                                                    selected
                                                {% endif %}>仅发布文章时
                                                <option{% if AUTO_EXCERPT == "总是截取" %} selected
                                                {% endif %}>总是截取
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_EXCERPT_3" | gettext }}</label>
                                            <input type="text" name="save_key"
                                                   class="form-control"
                                                   placeholder="{{ "SET_EXCERPT_3_PH" | gettext }}"
                                                   id="save-key"
                                                   value="{{ AUTO_EXCERPT_SAVE_KEY }}">
                                        </div>
                                    </div>
                                </div>
                                <div id="excerpt-container"></div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <input type="button" class="btn btn-primary"
                                               value="{{ "SUBMIT" | gettext }}"
                                               onclick="set_excerpt()">
                                    </div>
                                </div>
                            </div>
                        </form>
                        <form id="image-settings" onsubmit="return false;">
                            <hr class="my-4"/>
                            <h6 class="heading-small text-muted mb-4">
                                {{ "SET_IMAGE" | gettext }}</h6>
                            <div class="pl-lg-4">
                                <div class="row">
                                    {% csrf_token %}
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_IMAGE_1" | gettext }}</label>
                                            <select name="image-type" id="image-type"
                                                    class="form-control"
                                                    onchange="change_image_host(this.value)">
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div id="image-host-container"></div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <input type="button" class="btn btn-primary"
                                               value="{{ "SUBMIT" | gettext }}"
                                               onclick="set_image_host()">
                                    </div>
                                </div>
                            </div>
                        </form>
                        <form id="cdn-settings" onsubmit="return false;">
                            <hr class="my-4"/>
                            <h6 class="heading-small text-muted mb-4">{{ "SET_CDN" | gettext }}</h6>
                            <div class="pl-lg-4">
                                <div class="row">
                                    {% csrf_token %}
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_CDN_1" | gettext }}</label>
                                            <select class="form-control" name="CDNJS"
                                                    id="cdnjs">
                                                {% for cdn in ALL_CDN %}
                                                    <option{% if cdn.url == cdn_prev %}
                                                        selected{% endif %} value="{{ cdn.url }}"
                                                    >{{ cdn.name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <input type="button" class="btn btn-primary"
                                               value="{{ "SUBMIT" | gettext }}"
                                               onclick="set_cdn()">
                                    </div>
                                </div>
                            </div>
                        </form>
                        <form id="cust-settings" onsubmit="return false;">
                            <hr class="my-4"/>
                            <h6 class="heading-small text-muted mb-4">
                                {{ "SET_CUSTOM" | gettext }}</h6>
                            <div class="pl-lg-4">
                                <div class="row">
                                    {% csrf_token %}
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_CUSTOM_1" | gettext }}</label>
                                            <input type="text" name="name" class="form-control"
                                                   placeholder="{{ "SET_CUSTOM_1_PH" | gettext }}"
                                                   value="{{ QEXO_NAME }}">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_CUSTOM_2" | gettext }}</label>
                                            <input type="text" name="split" class="form-control"
                                                   placeholder="{{ "SET_CUSTOM_2_PH" | gettext }}"
                                                   value="{{ QEXO_SPLIT }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_CUSTOM_3" | gettext }}</label>
                                            <input type="text" name="logo"
                                                   class="form-control"
                                                   placeholder="{{ "SET_CUSTOM_3_PH" | gettext }}"
                                                   value="{{ QEXO_LOGO }}">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_CUSTOM_4" | gettext }}</label>
                                            <input type="text" name="icon"
                                                   class="form-control"
                                                   placeholder="{{ "SET_CUSTOM_4_PH" | gettext }}"
                                                   value="{{ QEXO_ICON }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-control-label">
                                                {{ "SET_CUSTOM_5" | gettext }}</label>
                                            <input type="text" name="logo-dark"
                                                   class="form-control"
                                                   placeholder="{{ "SET_CUSTOM_5_PH" | gettext }}"
                                                   value="{{ QEXO_LOGO_DARK }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <input type="button" class="btn btn-primary"
                                               value="{{ "SUBMIT" | gettext }}"
                                               onclick="submit_cust_config()">
                                        <input type="button" class="btn btn-white"
                                               value="{{ "RESET" | gettext }}"
                                               onclick="query_reset_cust()">
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="queryModal" tabindex="-1" aria-labelledby="queryModalLabel"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content bg-white">
                    <div class="modal-header" style="border: none;">
                        <h5 class="modal-title" id="queryModalLabel">{{ "TIPS" | gettext }}</h5>
                        <button type="button" data-bs-dismiss="modal"
                                aria-label="Close" style="box-sizing: content-box;width: 1em;height:
                            1em;padding: .25em;color: #8392ab;border: 0;border-radius: .375rem;
                            opacity: .5;background: none">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <a id="question"></a>
                    </div>
                    <div class="modal-footer" style="border: none;">
                        <button type="button" class="btn btn-secondary"
                                data-bs-dismiss="modal">{{ "CANCEL" | gettext }}
                        </button>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal"
                                onclick="purge()">{{ "CONFIRM" | gettext }}
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="queryWebhook" tabindex="-1" aria-labelledby="queryWebhookLabel"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content bg-white">
                    <div class="modal-header" style="border: none;">
                        <h5 class="modal-title" id="queryWebhookLabel">{{ "TIPS" | gettext }}</h5>
                        <button type="button" data-bs-dismiss="modal"
                                aria-label="Close" style="box-sizing: content-box;width: 1em;height:
                            1em;padding: .25em;color: #8392ab;border: 0;border-radius: .375rem;
                            opacity: .5;background: none">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        {{ "WARN_WEBHOOK" | gettext }}
                    </div>
                    <div class="modal-footer" style="border: none;">
                        <button type="button" class="btn btn-secondary"
                                data-bs-dismiss="modal">{{ "CANCEL" | gettext }}
                        </button>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal"
                                onclick="create_webhook()">{{ "CONFIRM" | gettext }}
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="queryUpdate" tabindex="-1" aria-labelledby="queryUpdateLabel"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content bg-white">
                    <div class="modal-header" style="border: none;">
                        <h5 class="modal-title" id="queryWebhookLabel">{{ "UPDATE" | gettext }}</h5>
                        <button type="button" data-bs-dismiss="modal"
                                aria-label="Close" style="box-sizing: content-box;width: 1em;height:
                            1em;padding: .25em;color: #8392ab;border: 0;border-radius: .375rem;
                            opacity: .5;background: none">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="col">
                            <label class="form-control-label">
                                {{ "UPDATE_CHANNEL" | gettext }}</label>
                            <select class="form-control" id="update-origin-branch">
                                {% for update in ALL_UPDATES %}
                                    <option>{{ update.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer" style="border: none;">
                        <button type="button" class="btn btn-secondary"
                                data-bs-dismiss="modal">{{ "CANCEL" | gettext }}
                        </button>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal"
                                onclick="do_update()">{{ "CONFIRM" | gettext }}
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="queryResetCust" tabindex="-1"
             aria-labelledby="queryResetCustLabel"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content bg-white">
                    <div class="modal-header" style="border: none;">
                        <h5 class="modal-title" id="queryResetCustLabel">{{ "TIPS" | gettext }}</h5>
                        <button type="button" data-bs-dismiss="modal"
                                aria-label="Close" style="box-sizing: content-box;width: 1em;height:
                            1em;padding: .25em;color: #8392ab;border: 0;border-radius: .375rem;
                            opacity: .5;background: none">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        {{ "WARN_RESET" | gettext }}
                    </div>
                    <div class="modal-footer" style="border: none;">
                        <button type="button" class="btn btn-secondary"
                                data-bs-dismiss="modal">{{ "CANCEL" | gettext }}
                        </button>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal"
                                onclick="reset_cust_config()">{{ "CONFIRM" | gettext }}
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% include "includes/footer.html" %}

    </div>

{% endblock content %}

<!-- Specific JS goes HERE -->
{% block javascripts %}

    <script>
        function getBaseUrl() {
            let ishttps = 'https:' == document.location.protocol ? true : false;
            let url = window.location.host;
            if (ishttps) {
                url = 'https://' + url;
            } else {
                url = 'http://' + url;
            }
            return url;
        }

        function set_hexo(force) {
            let loading;
            loading = new KZ_Loading('{{ "SAVING" | gettext }}');
            loading.show();
            let form = $('#hexo-settings').serializeArray();
            let params = {};
            for (let i = 0; i < form.length; i++) {
                params[form[i]["name"]] = form[i]["value"];
            }
            delete params["provider"]; // remove provider name from params array
            delete params["csrfmiddlewaretoken"]; // remove the CSRF token from params array
            $.ajax({
                url: '/api/set_hexo/',
                method: 'post',
                data: {
                    "provider": JSON.stringify({
                        "provider": $("#provider-container").val(),
                        "params": params
                    }),
                    "force": !!force
                },
                dataType: "json",
                success: function (res) {
                    loading.destroy();
                    if (res.status) {
                        notyf.success(res.msg);
                        now_provider = {
                            "provider": $("#provider-container").val(),
                            "params": params,
                            "force": !!force
                        };
                    } else {
                        notyf.error(res.msg);
                    }
                },
                error: function (res) {
                    loading.destroy();
                    notyf.error("{{ "NETWORK_ERROR" | gettext }}");
                }
            })
        }

        function submit_user_config() {
            if (!$("input[name='username']").val()) {
                notyf.error('{{ "RESET_PASSWORD_NO_USERNAME" | gettext }}');
                return false;
            }
            if (!$("input[name='password']").val()) {
                notyf.error('{{ "RESET_PASSWORD_NO_PASSWORD" | gettext }}');
                return false;
            }
            if (!$("input[name='newpassword']").val()) {
                notyf.error('{{ "RESET_PASSWORD_NO" | gettext }}');
                return false;
            }
            if ($("input[name='newpassword']").val() != $("input[name='repassword']").val()) {
                notyf.error('{{ "RESET_PASSWORD_NO_MATCH" | gettext }}');
                return false;
            }
            let loading = new KZ_Loading("{{ "SAVING" | gettext }}");
            loading.show();
            $.ajax({
                url: '/api/set_user/',
                method: 'post',
                data: $('#user-settings').serialize(),
                dataType: "json",
                success: function (res) {
                    loading.destroy();
                    if (res.status) {
                        notyf.success(res.msg);
                        setTimeout(location.reload(), 1000);
                    } else {
                        notyf.error(res.msg);
                    }
                },
                error: function (res) {
                    loading.destroy();
                    notyf.error("{{ "NETWORK_ERROR" | gettext }}");
                }
            })
        }

        function set_image_host() {
            let loading = new KZ_Loading('{{ "SAVING" | gettext }}');
            loading.show();
            let form = $('#image-settings').serializeArray();
            let params = {};
            for (let i = 0; i < form.length; i++) {
                params[form[i]["name"]] = form[i]["value"];
            }
            delete params["image-type"]; // remove provider name from params array
            delete params["csrfmiddlewaretoken"]; // remove the CSRF token from params array
            $.ajax({
                url: '/api/set_image_host/',
                method: 'post',
                data: {
                    "image_host": JSON.stringify({
                        "type": $("#image-type").val(),
                        "params": params
                    })
                },
                dataType: "json",
                success: function (res) {
                    loading.destroy();
                    if (res.status) {
                        notyf.success(res.msg);
                    } else {
                        notyf.error(res.msg);
                    }
                },
                error: function (res) {
                    loading.destroy();
                    notyf.error("{{ "NETWORK_ERROR" | gettext }}");
                }
            })
        }

        function query_purge() {
            $("#question").text("{{ "CACHE_CLEAN_REQUEST" | gettext }}");
            $("#queryModal").modal("show");
        }

        function query_webhook() {
            $("#queryWebhook").modal("show");
        }

        function query_update() {
            $("#queryUpdate").modal("show");
        }

        function query_reset_cust() {
            $("#queryResetCust").modal("show");
        }

        function purge() {
            let loading = new KZ_Loading();
            loading.show();
            $.ajax({
                url: '/api/purge/',
                method: 'get',
                dataType: "json",
                success: function (res) {
                    loading.destroy();
                    if (res.status) {
                        notyf.success(res.msg);
                    } else {
                        notyf.error(res.msg);
                    }
                },
                error: function (res) {
                    loading.destroy();
                    notyf.error("{{ "NETWORK_ERROR" | gettext }}");
                }
            })
        }

        function create_webhook() {
            let loading = new KZ_Loading();
            loading.show();
            $.ajax({
                url: '/api/create_webhook/',
                method: 'post',
                data: {
                    "csrfmiddlewaretoken": "{{ csrf_token }}", "uri": getBaseUrl() + "/api/webhook/"
                },
                dataType: "json",
                success: function (res) {
                    loading.destroy();
                    if (res.status) {
                        notyf.success(res.msg);
                    } else {
                        notyf.error(res.msg);
                    }
                },
                error: function (res) {
                    loading.destroy();
                    notyf.error("{{ "NETWORK_ERROR" | gettext }}");
                }
            })
        }

        function set_cdn() {
            let loading = new KZ_Loading('{{ "SAVING" | gettext }}');
            loading.show();
            $.ajax({
                url: '/api/set_cdn/',
                method: 'post',
                data: {"cdn": $("#cdnjs").val()},
                dataType: "json",
                success: function (res) {
                    loading.destroy();
                    if (res.status) {
                        notyf.success(res.msg);
                    } else {
                        notyf.error(res.msg);
                    }
                },
                error: function (res) {
                    loading.destroy();
                    notyf.error("{{ "NETWORK_ERROR" | gettext }}");
                }
            })
        }

        function submit_cust_config() {
            let loading = new KZ_Loading('{{ "SAVING" | gettext }}');
            loading.show();
            $.ajax({
                url: '/api/set_cust/',
                method: 'post',
                data: $('#cust-settings').serialize(),
                dataType: "json",
                success: function (res) {
                    loading.destroy();
                    if (res.status) {
                        notyf.success(res.msg);
                    } else {
                        notyf.error(res.msg);
                    }
                },
                error: function (res) {
                    loading.destroy();
                    notyf.error("{{ "NETWORK_ERROR" | gettext }}");
                }
            })
        }

        function reset_cust_config() {
            let loading = new KZ_Loading('{{ "SAVING" | gettext }}');
            loading.show();
            $.ajax({
                url: '/api/set_cust/',
                method: 'post',
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    'logo': 'https://unpkg.com/qexo-static@{{ static_version }}/qexo/images/qexo.png',
                    'icon': 'https://unpkg.com/qexo-static@{{ static_version }}/qexo/images/icon.png',
                    'logo-dark': 'https://unpkg.com/qexo-static@{{ static_version }}/qexo/images/qexo-dark.png',
                    'name': 'Hexo管理面板',
                    'split': ' - '
                },
                dataType: "json",
                success: function (res) {
                    loading.destroy();
                    if (res.status) {
                        notyf.success(res.msg);
                    } else {
                        notyf.error(res.msg);
                    }
                },
                error: function (res) {
                    loading.destroy();
                    notyf.error("{{ "NETWORK_ERROR" | gettext }}");
                }
            })
        }

        function set_excerpt() {
            let loading = new KZ_Loading('{{ "SAVING" | gettext }}');
            loading.show();
            let form = $('#excerpt-settings').serializeArray();
            let params = {};
            for (let i = 0; i < form.length; i++) {
                params[form[i]["name"]] = form[i]["value"];
            }
            delete params["auto-excerpt"];
            delete params["excerpt-type"];
            delete params["csrfmiddlewaretoken"];
            $.ajax({
                url: '/api/set_excerpt/',
                method: 'post',
                data: {
                    "excerpt": JSON.stringify({
                        "method": $("#excerpt-method-container").val(),
                        "auto": $("#auto-excerpt").val(),
                        "save_key": $("#save-key").val(),
                        "params": params
                    })
                },
                dataType: "json",
                success: function (res) {
                    loading.destroy();
                    if (res.status) {
                        notyf.success(res.msg);
                    } else {
                        notyf.error(res.msg);
                    }
                },
                error: function (res) {
                    loading.destroy();
                    notyf.error("{{ "NETWORK_ERROR" | gettext }}");
                }
            })
        }

        function set_api() {
            let loading = new KZ_Loading('{{ "SAVING" | gettext }}');
            loading.show();
            $.ajax({
                url: '/api/set_api/',
                method: 'post',
                data: $('#apikey-settings').serialize(),
                dataType: "json",
                success: function (res) {
                    loading.destroy();
                    if (res.status) {
                        notyf.success(res.msg);
                    } else {
                        notyf.error(res.msg);
                    }
                },
                error: function (res) {
                    loading.destroy();
                    notyf.error("{{ "NETWORK_ERROR" | gettext }}");
                }
            })
        }

        function set_statistic() {
            let loading = new KZ_Loading('{{ "SAVING" | gettext }}');
            loading.show();
            $.ajax({
                url: '/api/set_statistic/',
                method: 'post',
                data: $('#statistic-settings').serialize(),
                dataType: "json",
                success: function (res) {
                    loading.destroy();
                    if (res.status) {
                        notyf.success(res.msg);
                    } else {
                        notyf.error(res.msg);
                    }
                },
                error: function (res) {
                    loading.destroy();
                    notyf.error("{{ "NETWORK_ERROR" | gettext }}");
                }
            })
        }

        function set_onepush() {
            let loading = new KZ_Loading('{{ "SAVING" | gettext }}');
            loading.show();
            let form = $('#notify-settings').serializeArray();
            let params = {};
            for (let i = 0; i < form.length; i++) {
                if (form[i]["value"]) {
                    params[form[i]["name"]] = form[i]["value"];
                }
            }
            delete params["notifier"]; // remove notifier name from params array
            delete params["csrfmiddlewaretoken"]; // remove the CSRF token from params array
            $.ajax({
                url: '/api/set_onepush/',
                method: 'post',
                data: {
                    "onepush": JSON.stringify({
                        "notifier": $("#onepush-container").val(),
                        "params": params
                    })
                },
                dataType: "json",
                success: function (res) {
                    loading.destroy();
                    if (res.status) {
                        notyf.success(res.msg);
                        now_pusher = {
                            "notifier": $("#onepush-container").val(),
                            "params": params
                        };
                    } else {
                        notyf.error(res.msg);
                    }
                },
                error: function (res) {
                    loading.destroy();
                    notyf.error("{{ "NETWORK_ERROR" | gettext }}");
                }
            })
        }

        function test_onepush() {
            let loading = new KZ_Loading();
            loading.show();
            let form = $('#notify-settings').serializeArray();
            let params = {};
            for (let i = 0; i < form.length; i++) {
                if (form[i]["value"]) {
                    params[form[i]["name"]] = form[i]["value"];
                }
            }
            delete params["notifier"]; // remove notifier name from params array
            delete params["csrfmiddlewaretoken"]; // remove the CSRF token from params array
            $.ajax({
                url: '/api/test_onepush/',
                method: 'post',
                data: {
                    "onepush": JSON.stringify({
                        "notifier": $("#onepush-container").val(),
                        "params": params
                    })
                },
                dataType: "json",
                success: function (res) {
                    loading.destroy();
                    if (res.status) {
                        notyf.success(res.msg);
                    } else {
                        notyf.error(res.msg);
                    }
                },
                error: function (res) {
                    loading.destroy();
                    notyf.error("{{ "NETWORK_ERROR" | gettext }}");
                }
            })
        }

        function submit_abbrlink_config() {
            let loading = new KZ_Loading('{{ "SAVING" | gettext }}');
            loading.show();
            $.ajax({
                url: '/api/set_abbrlink/',
                method: 'post',
                data: $('#abbrlink-settings').serialize(),
                dataType: "json",
                success: function (res) {
                    loading.destroy();
                    if (res.status) {
                        notyf.success(res.msg);
                    } else {
                        notyf.error(res.msg);
                    }
                },
                error: function (res) {
                    loading.destroy();
                    notyf.error("{{ "NETWORK_ERROR" | gettext }}");
                }
            })
        }

        function submit_security_config() {
            let loading = new KZ_Loading('{{ "SAVING" | gettext }} ');
            loading.show();
            $.ajax({
                url: '/api/set_security/',
                method: 'post',
                data: $('#security-settings').serialize(),
                dataType: "json",
                success: function (res) {
                    loading.destroy();
                    if (res.status) {
                        notyf.success(res.msg);
                    } else {
                        notyf.error(res.msg);
                    }
                },
                error: function (res) {
                    loading.destroy();
                    notyf.error("{{ "NETWORK_ERROR" | gettext }}");
                }
            })
        }

        function do_update() {
            let loading = new KZ_Loading('{{ "UPDATING" | gettext }}');
            loading.show();
            $.ajax({
                url: '/api/do_update/',
                method: 'post',
                dataType: "json",
                data: {
                    "branch": $("#update-origin-branch").val(), csrfmiddlewaretoken:
                        '{{ csrf_token }}'
                },
                success: function (res) {
                    loading.destroy();
                    if (res.status) {
                        notyf.success(res.msg);
                    } else {
                        notyf.error(res.msg);
                    }
                },
                error: function (res) {
                    loading.destroy();
                    notyf.error("{{ "NETWORK_ERROR" | gettext }}");
                }
            })
        }

        const all_providers = {{ all_providers | safe }};
        {% if PROVIDER %}
            var now_provider = {{ PROVIDER | safe }};
        {% else %}
            var now_provider = "";
        {% endif %}
        function change_provider(provider) {
            let params = all_providers[provider];
            let t = 0;
            let html = '';
            if (provider === now_provider["provider"]) {
                for (let key in params) {
                    if (t % 2 === 0) {  // first param
                        html += `<div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="form-control-label">` +
                            params[key]["description"] +
                            `</label>
                                        <input type="text" name="` + key + `" class="form-control"
                                               placeholder="` + params[key]["placeholder"] + `"
                                               value="` + escapeString(now_provider["params"][key]) + `">
                                    </div>
                                </div>`
                        t += 1;
                    } else {
                        html += `<div class="col-lg-6">
                                <div class="form-group">
                                    <label class="form-control-label">` + params[key]["description"] + `</label>
                                    <input type="text" name="` + key + `" class="form-control"
                                           placeholder="` + params[key]["placeholder"] + `"
                                           value="` + escapeString(now_provider["params"][key]) + `">
                                </div>
                            </div>
                        </div>`
                        t += 1;
                    }
                }
                if (t % 2 === 1) {
                    html += '</div>';
                }
            } else {
                for (let key in params) {
                    if (t % 2 === 0) {  // first param
                        html += `<div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="form-control-label">` + params[key]["description"] + `</label>
                                        <input type="text" name="` + key + `" class="form-control"
                                               placeholder="` + params[key]["placeholder"] + `"
                                               value="">
                                    </div>
                                </div>`
                        t += 1;
                    } else {
                        html += `<div class="col-lg-6">
                                <div class="form-group">
                                    <label class="form-control-label">` + params[key]["description"] + `</label>
                                    <input type="text" name="` + key + `" class="form-control"
                                           placeholder="` + params[key]["placeholder"] + `"
                                           value="">
                                </div>
                            </div>
                        </div>`
                        t += 1;
                    }
                }
                if (t % 2 === 1) {
                    html += '</div>';
                }
            }
            $("#hexo-settings-container").html(html);
        }

        let provider_container = "";
        for (let key in all_providers) {
            if (now_provider["provider"] === key) {
                provider_container += `<option selected>` + key + `</option>`;
                change_provider(key);
            } else {
                provider_container += `<option>` + key + `</option>`;
            }
        }
        if (!now_provider["provider"]) {
            change_provider("github");
        }
        $("#provider-container").html(provider_container);


        {% if ONEPUSH %}
            var now_pusher = {{ ONEPUSH | safe }};
        {% else %}
            var now_pusher = "";
        {% endif %}
        const all_pushers = {{ all_pushers | safe }};

        function change_pusher(pusher) {
            let params = all_pushers[pusher];
            if (typeof params !== "object") {
                console.log("获取Pusher失败，显示Bark");
                params = all_pushers["Bark"];
            }
            let t = 0, tmp;
            let html = '';
            let required = params["required"];
            let optional = params["optional"];
            if (pusher === now_pusher["notifier"]) {
                if (typeof required === "object") {
                    for (let i = 0; i < required.length; i++) {
                        tmp = now_pusher["params"][required[i]] ?
                            now_pusher["params"][required[i]] : "";
                        if (t % 2 === 0) {  // first param
                            html += `<div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="form-control-label">` + required[i] + `({{ "REQUIRED" | gettext }})
                                        </label>
                                        <input type="text" name="` + required[i] + `" class="form-control"
                                               placeholder="` + required[i] + `"
                                               value="` + escapeString(tmp) + `">
                                    </div>
                                </div>`
                            t += 1;
                        } else {
                            html += `<div class="col-lg-6">
                                <div class="form-group">
                                    <label class="form-control-label">` + required[i] + `({{ "REQUIRED" | gettext }})</label>
                                    <input type="text" name="` + required[i] + `" class="form-control"
                                           placeholder="` + required[i] + `"
                                           value="` + escapeString(tmp) + `">
                                </div>
                            </div>
                        </div>`
                            t += 1;
                        }
                    }
                }
                if (typeof optional === "object") {
                    for (let i = 0; i < optional.length; i++) {
                        tmp = now_pusher["params"][optional[i]] ?
                            now_pusher["params"][optional[i]] : "";
                        if (t % 2 === 0) {  // first param
                            html += `<div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="form-control-label">` + optional[i] + `</label>
                                        <input type="text" name="` + optional[i] + `" class="form-control"
                                               placeholder="` + optional[i] + `"
                                               value="` + escapeString(tmp) + `">
                                    </div>
                                </div>`
                            t += 1;
                        } else {
                            html += `<div class="col-lg-6">
                                <div class="form-group">
                                    <label class="form-control-label">` + optional[i] + `</label>
                                    <input type="text" name="` + optional[i] + `" class="form-control"
                                           placeholder="` + optional[i] + `"
                                           value="` + escapeString(tmp) + `">
                                </div>
                            </div>
                        </div>`
                            t += 1;
                        }
                    }
                }
                if (t % 2 === 1) {
                    html += '</div>';
                }
            } else {
                if (typeof required === "object") {
                    for (let i = 0; i < required.length; i++) {
                        if (t % 2 === 0) {  // first param
                            html += `<div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="form-control-label">` + required[i] + `({{ "REQUIRED" | gettext }})
                                        </label>
                                        <input type="text" name="` + required[i] + `" class="form-control"
                                               placeholder="` + required[i] + `"
                                               value="">
                                    </div>
                                </div>`
                            t += 1;
                        } else {
                            html += `<div class="col-lg-6">
                                <div class="form-group">
                                    <label class="form-control-label">` + required[i] + `({{ "REQUIRED" | gettext }})</label>
                                    <input type="text" name="` + required[i] + `" class="form-control"
                                           placeholder="` + required[i] + `"
                                           value="">
                                </div>
                            </div>
                        </div>`
                            t += 1;
                        }
                    }
                }
                if (typeof optional === "object") {
                    for (let i = 0; i < optional.length; i++) {
                        if (t % 2 === 0) {  // first param
                            html += `<div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="form-control-label">` + optional[i] +
                                `</label>
                                        <input type="text" name="` + optional[i] + `" class="form-control"
                                               placeholder="` + optional[i] + `"
                                               value="">
                                    </div>
                                </div>`
                            t += 1;
                        } else {
                            html += `<div class="col-lg-6">
                                <div class="form-group">
                                    <label class="form-control-label">` + optional[i] + `</label>
                                    <input type="text" name="` + optional[i] + `" class="form-control"
                                           placeholder="` + optional[i] + `"
                                           value="">
                                </div>
                            </div>
                        </div>`
                            t += 1;
                        }
                    }
                }
                if (t % 2 === 1) {
                    html += '</div>';
                }
            }
            $("#onepush-settings-container").html(html);
        }

        let onepush_container = "";
        for (let key in all_pushers) {
            if (now_pusher["notifier"] === key) {
                onepush_container += `<option selected>` + key + `</option>`;
                change_pusher(key);
            } else {
                onepush_container += `<option>` + key + `</option>`;
            }
        }
        if (!now_pusher["notifier"]) {
            change_pusher("Bark");
        }
        $("#onepush-container").html(onepush_container);

        const all_image_hosts = {{ all_image_hosts | safe }};
        {% if IMG_HOST %}
            var now_image_host = {{ IMG_HOST | safe }};
        {% else %}
            var now_image_host = "";
        {% endif %}
        function change_image_host(provider) {
            let params = all_image_hosts[provider];
            let t = 0;
            let html = '';
            if (provider === "关闭") {
                $("#image-host-container").html(html);
                return;
            }
            if (provider === now_image_host["type"]) {
                for (let key in params) {
                    if (t % 2 === 0) {  // first param
                        html += `<div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="form-control-label">` +
                            params[key]["description"] +
                            `</label>
                                        <input type="text" name="` + key + `" class="form-control"
                                               placeholder="` + params[key]["placeholder"] + `"
                                               value="` + escapeString
                            (now_image_host["params"][key]) + `">
                                    </div>
                                </div>`
                        t += 1;
                    } else {
                        html += `<div class="col-lg-6">
                                <div class="form-group">
                                    <label class="form-control-label">` + params[key]["description"] + `</label>
                                    <input type="text" name="` + key + `" class="form-control"
                                           placeholder="` + params[key]["placeholder"] + `"
                                           value="` + escapeString(now_image_host["params"][key])
                            + `">
                                </div>
                            </div>
                        </div>`
                        t += 1;
                    }
                }
                if (t % 2 === 1) {
                    html += '</div>';
                }
            } else {
                for (let key in params) {
                    if (t % 2 === 0) {  // first param
                        html += `<div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="form-control-label">` + params[key]["description"] + `</label>
                                        <input type="text" name="` + key + `" class="form-control"
                                               placeholder="` + params[key]["placeholder"] + `"
                                               value="">
                                    </div>
                                </div>`
                        t += 1;
                    } else {
                        html += `<div class="col-lg-6">
                                <div class="form-group">
                                    <label class="form-control-label">` + params[key]["description"] + `</label>
                                    <input type="text" name="` + key + `" class="form-control"
                                           placeholder="` + params[key]["placeholder"] + `"
                                           value="">
                                </div>
                            </div>
                        </div>`
                        t += 1;
                    }
                }
                if (t % 2 === 1) {
                    html += '</div>';
                }
            }
            $("#image-host-container").html(html);
        }

        let image_type_container = "<option>关闭</option>";
        for (let key in all_image_hosts) {
            if (now_image_host["type"] === key) {
                image_type_container += `<option selected>` + key + `</option>`;
                change_image_host(key);
            } else {
                image_type_container += `<option>` + key + `</option>`;
            }
        }
        if (!now_image_host["type"]) {
            change_image_host("关闭");
        }
        $("#image-type").html(image_type_container);

        const all_excerpt = {
            "本地": {
                "length": {"description": "{{ "EXCERPT_LOCAL_LENGTH" | gettext }}",
                    "placeholder": "{{ "EXCERPT_LOCAL_LENGTH_PH" | gettext }}"}
            },
            "TianliGPT": {
                "key": {"description": "{{ "EXCERPT_TIANLI_KEY" | gettext }}", "placeholder": "{{ "EXCERPT_TIANLI_KEY_PH" | gettext }}"},
                "length": {"description": "{{ "EXCERPT_TIANLI_LENGTH" | gettext }}", "placeholder": "{{ "EXCERPT_TIANLI_LENGTH_PH" | gettext }}"}
            },
            "ChatGPT": {
                "api_key": {
                    "description": "{{ "EXCERPT_CHATGPT_API_KEY" | gettext }}",
                    "placeholder": "{{ "EXCERPT_CHATGPT_API_KEY_PH" | gettext }}"
                },
                "api": {
                    "description": "{{ "EXCERPT_CHATGPT_API" | gettext }}",
                    "placeholder": "{{ "EXCERPT_CHATGPT_API_PH" | gettext }}"
                },
                "length": {
                    "description": "{{ "EXCERPT_CHATGPT_LENGTH" | gettext }}",
                    "placeholder": "{{ "EXCERPT_CHATGPT_LENGTH_PH" | gettext }}"
                },
                "model": {
                    "description": "{{ "EXCERPT_CHATGPT_MODEL" | gettext }}",
                    "placeholder": "{{ "EXCERPT_CHATGPT_MODEL_PH" | gettext }}"
                },
                
            }
        };
        {% if AUTO_EXCERPT_CONFIG %}
            var now_excerpt = {{ AUTO_EXCERPT_CONFIG | safe }};
        {% else %}
            var now_excerpt = "";
        {% endif %}

        function change_excerpt(provider) {
            let params = all_excerpt[provider];
            let t = 0;
            let html = '';
            if (provider === now_excerpt.method) {
                for (let key in params) {
                    if (t % 2 === 0) {  // first param
                        html += `<div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="form-control-label">` +
                            params[key]["description"] +
                            `</label>
                                        <input type="text" name="` + key + `" class="form-control"
                                               placeholder="` + params[key]["placeholder"] + `"
                                               value="` + escapeString(now_excerpt["params"][key]) + `">
                                    </div>
                                </div>`
                        t += 1;
                    } else {
                        html += `<div class="col-lg-6">
                                <div class="form-group">
                                    <label class="form-control-label">` + params[key]["description"] + `</label>
                                    <input type="text" name="` + key + `" class="form-control"
                                           placeholder="` + params[key]["placeholder"] + `"
                                           value="` + escapeString(now_excerpt["params"][key])
                            + `">
                                </div>
                            </div>
                        </div>`
                        t += 1;
                    }
                }
            } else {
                for (let key in params) {
                    if (t % 2 === 0) {  // first param
                        html += `<div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="form-control-label">` + params[key]["description"] + `</label>
                                        <input type="text" name="` + key + `" class="form-control"
                                               placeholder="` + params[key]["placeholder"] + `"
                                               value="">
                                    </div>
                                </div>`
                        t += 1;
                    } else {
                        html += `<div class="col-lg-6">
                                <div class="form-group">
                                    <label class="form-control-label">` + params[key]["description"] + `</label>
                                    <input type="text" name="` + key + `" class="form-control"
                                           placeholder="` + params[key]["placeholder"] + `"
                                           value="">
                                </div>
                            </div>
                        </div>`
                        t += 1;
                    }
                }
            }
            if (t % 2 === 1) {
                html += '</div>';
            }
            $("#excerpt-container").html(html);
        }

        let excerpt_container = "";
        for (let key in all_excerpt) {
            if (now_excerpt["method"] === key) {
                excerpt_container += `<option selected>` + key + `</option>`;
                change_excerpt(key);
            } else {
                excerpt_container += `<option>` + key + `</option>`;
            }
        }
        if (!now_excerpt["method"]) {
            change_excerpt("本地");
        }
        $("#excerpt-method-container").html(excerpt_container);

    </script>
{% endblock javascripts %}
